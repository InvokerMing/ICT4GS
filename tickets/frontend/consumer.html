<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solo City Attractions - Online Ticketing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Smooth scrolling for the navigation bar */
            scroll-behavior: smooth;
        }

        /* Basic view switching */
        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* Original card and input styles (keeping for purchase view) */
        .card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            cursor: pointer;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 500;
            color: #4a5568;
        }

        .input-field {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #cbd5e0;
            border-radius: 0.375rem;
            margin-bottom: 0.75rem;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }

        .input-field:focus {
            outline: none;
            border-color: #63b3ed;
            box-shadow: 0 0 0 3px rgba(99, 179, 237, 0.3);
        }

        .quantity-input {
            width: 70px;
            text-align: center;
        }

        /* Specific style for quantity */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #4299e1;
            animation: spin 1s ease infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Modal Styles*/
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 25px;
            border: 1px solid #888;
            width: 90%;
            max-width: 400px;
            border-radius: 8px;
            text-align: center;
            position: relative;
        }

        .close-button {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        #qrcode {
            margin: 15px auto;
            width: 200px;
            height: 200px;
        }

        #qrcode img {
            display: block;
            margin: auto;
        }

        /* Tooltip Styles*/
        .tooltip-trigger {
            display: inline-block;
            margin-left: 5px;
            cursor: pointer;
            color: #667eea;
            border: 1px solid #cbd5e0;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            text-align: center;
            line-height: 16px;
            font-size: 12px;
            position: relative;
        }

        .tooltip-text {
            visibility: hidden;
            width: 220px;
            background-color: #2d3748;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px 12px;
            position: absolute;
            z-index: 1;
            bottom: 135%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 13px;
            line-height: 1.4;
            pointer-events: none;
        }

        .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #2d3748 transparent transparent transparent;
        }

        .tooltip-trigger:hover .tooltip-text,
        .tooltip-trigger:focus .tooltip-text,
        .tooltip-trigger.active .tooltip-text {
            visibility: visible;
            opacity: 1;
            pointer-events: auto;
        }

        /* Language switcher style*/
        .lang-switcher {
            text-align: right;
            margin-bottom: 1rem;
            /* Adjust margin as needed */
            margin-right: 0.5rem;
            /* Adjust margin as needed */
            position: fixed;
            /* Changed to fixed */
            top: 0.5rem;
            /* Adjust position as needed */
            right: 0.5rem;
            /* Adjust position as needed */
            z-index: 50;
            /* Ensure it's above other content */
        }

        .lang-switcher select {
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #f0f0f0;
            cursor: pointer;
        }


        /* --- New Styles for Homepage Beautification --- */
        .attraction-block {
            width: 100%;
            display: flex;
            flex-direction: column;
            /* Stack content vertically on small screens */
            align-items: center;
            padding: 2rem;
            margin-bottom: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            /* Add a subtle shadow */
            color: #333;
            /* Default text color */
        }

        @media (min-width: 768px) {
            .attraction-block {
                flex-direction: row;
                /* Row layout on medium screens and up */
            }
        }

        .attraction-image-container {
            width: 100%;
            /* Full width on small screens */
            max-width: 400px;
            /* Limit image width */
            margin-bottom: 1.5rem;
            /* Space below image on small screens */
            border-radius: 0.375rem;
            overflow: hidden;
            /* Hide overflow for rounded corners */
        }

        @media (min-width: 768px) {
            .attraction-image-container {
                width: 40%;
                /* Image takes 40% width on medium screens and up */
                margin-right: 2rem;
                /* Space to the right of the image */
                margin-bottom: 0;
                /* No bottom margin on larger screens */
            }
        }

        .attraction-image {
            width: 100%;
            height: 250px;
            /* Fixed height for consistency */
            object-fit: cover;
            /* Cover the container */
            display: block;
            /* Remove extra space below image */
            border-radius: 0.375rem;
        }

        .attraction-info {
            width: 100%;
            /* Full width on small screens */
            flex-grow: 1;
            /* Take remaining space on larger screens */
        }

        @media (min-width: 768px) {
            .attraction-info {
                width: 60%;
                /* Info takes 60% width on medium screens and up */
            }
        }

        .attraction-info h3 {
            font-size: 1.875rem;
            /* 3xl */
            font-weight: 700;
            /* Bold */
            margin-bottom: 0.5rem;
            color: inherit;
            /* Inherit color from block */
        }

        .attraction-info .summary {
            font-size: 1rem;
            /* Base size */
            color: inherit;
            /* Inherit color from block */
            margin-bottom: 1rem;
        }

        .attraction-info .price {
            font-size: 1.25rem;
            /* xl */
            font-weight: 700;
            color: inherit;
            /* Inherit color from block */
            margin-bottom: 1.5rem;
        }

        .attraction-info .book-button {
            display: inline-block;
            background-color: #10B981;
            /* Green 500 */
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            font-size: 1.125rem;
            /* lg */
            font-weight: 500;
            transition: background-color 0.3s ease;
            cursor: pointer;
        }

        .attraction-info .book-button:hover {
            background-color: #059669;
            /* Green 600 */
        }

        /* Floating Navigation Bar */
        #floating-nav {
            position: fixed;
            right: 1rem;
            /* 4 units from right */
            top: 50%;
            /* Center vertically */
            transform: translateY(-50%);
            z-index: 500;
            background-color: rgba(255, 255, 255, 0.9);
            /* Semi-transparent white */
            border-radius: 0.5rem;
            padding: 0.75rem;
            /* 3 units padding */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: none;
            /* Hidden by default, shown by JS on homepage */
            flex-direction: column;
            gap: 0.5rem;
            /* 2 units gap between buttons */
        }

        #floating-nav button {
            background: none;
            border: none;
            padding: 0.5rem 0.75rem;
            /* 2 units vertical, 3 units horizontal */
            cursor: pointer;
            font-size: 0.875rem;
            /* sm */
            color: #4A5568;
            /* Gray 700 */
            border-radius: 0.375rem;
            /* rounded-md */
            transition: background-color 0.2s ease, color 0.2s ease;
            text-align: left;
            /* Align text left */
            width: 100%;
            /* Full width button */
        }

        #floating-nav button:hover {
            background-color: #E2E8F0;
            /* Gray 200 */
            color: #2D3748;
            /* Gray 800 */
        }

        /* Hide floating nav on small screens */
        @media (max-width: 1023px) {
            #floating-nav {
                display: none !important;
            }
        }


        /* --- New Styles for Attraction Detail Page --- */
        #attraction-detail-view .detail-section {
            background-color: #f7fafc;
            /* Gray 100 */
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        #attraction-detail-view .detail-section h3 {
            font-size: 1.5rem;
            /* 2xl */
            font-weight: 600;
            /* Semibold */
            color: #2D3748;
            /* Gray 800 */
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #E2E8F0;
            /* Gray 200 */
        }

        #attraction-detail-view .detail-section p,
        #attraction-detail-view .detail-section ul,
        #attraction-detail-view .detail-section li {
            font-size: 1rem;
            line-height: 1.6;
            color: #4A5568;
            /* Gray 700 */
        }

        #attraction-detail-view .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            /* Responsive grid */
            gap: 1rem;
            /* 4 units gap */
            margin-top: 1rem;
        }

        #attraction-detail-view .image-gallery img {
            width: 100%;
            height: 150px;
            /* Fixed height for gallery images */
            object-fit: cover;
            border-radius: 0.375rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        #attraction-detail-view .contact-info p {
            margin-bottom: 0.5rem;
        }

        /* Example Background Colors (Tailwind Classes) */
        .bg-blue-100 {
            background-color: #EBF8FF;
            color: #2B6CB0;
            /* Blue 700 */
        }

        .bg-green-100 {
            background-color: #F0FFF4;
            color: #2F855A;
            /* Green 700 */
        }

        .bg-yellow-100 {
            background-color: #FFFFF0;
            color: #B7791F;
            /* Yellow 700 */
        }

        .bg-purple-100 {
            background-color: #FAF5FF;
            color: #6B46C1;
            /* Purple 700 */
        }

        .bg-pink-100 {
            background-color: #FFF5F7;
            color: #E53E3E;
            /* Red 600 - Using red for contrast */
        }

        /* Add more colors as needed */
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>

<body class="bg-gray-100 p-4 md:p-8">

    <div id="lang-switcher" class="lang-switcher">
        <select id="language-select">
            <option value="en">English</option>
            <option value="zh">中文</option>
        </select>
    </div>

    <div class="container mx-auto max-w-6xl bg-white p-6 rounded-lg shadow-md">

        <div id="attraction-list-view" class="view active">
            <h1 id="main-title" class="text-3xl font-bold text-center text-gray-800 mb-8">Solo City Attractions Online
                Ticketing</h1>
            <div id="attractions-loading" class="text-center py-10">
                <div class="spinner"></div>
                <p id="loading-text" class="text-gray-500">Loading attraction information...</p>
            </div>
            <div id="attractions-list-container" class="flex flex-col gap-8 mb-8 hidden">
            </div>
            <div id="attractions-error" class="text-center text-red-600 font-medium mb-4 hidden"></div>
        </div>

        <div id="attraction-detail-view" class="view">
            <button onclick="showView('attraction-list-view')" class="mb-4 text-blue-600 hover:underline">&larr; <span
                    class="back-to-list-text">Back to List</span></button>
            <div id="detail-content">
            </div>
            <div id="detail-error" class="text-center text-red-600 font-medium mb-4 hidden"></div>
        </div>

        <div id="purchase-view" class="view">
            <button onclick="showView('attraction-detail-view', currentAttractionId)"
                class="mb-4 text-blue-600 hover:underline">&larr; <span class="back-to-detail-text">Back to
                    Details</span></button>
            <h2 id="purchase-title" class="text-2xl font-semibold mb-4">Book Tickets for: <span
                    id="purchase-attraction-name"></span></h2>
            <form id="purchase-form" onsubmit="handleProceedToPayment(event)">
                <div class="mb-4 p-4 border rounded bg-gray-50">
                    <h3 class="text-lg font-medium mb-3"><span class="ticket-selection-title">Ticket Selection</span>
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <label for="quantity-full" class="mb-0 ticket-type-full-label">Full Price Ticket:</label>
                            <input type="number" id="quantity-full" name="quantity_full" value="1" min="0" max="10"
                                class="input-field quantity-input mb-0" oninput="updatePurchaseSummary()">
                        </div>
                        <div class="flex justify-between items-center">
                            <label for="quantity-discount" class="mb-0 ticket-type-discount-label">
                                Discount Ticket (50%):
                                <span class="tooltip-trigger" tabindex="0" onclick="toggleTooltip(this)"
                                    onmouseenter="showTooltip(this)" onmouseleave="hideTooltip(this)"
                                    onfocus="showTooltip(this)" onblur="hideTooltip(this)">?
                                    <span class="tooltip-text tooltip-discount-text">Eligible: Students, Seniors (60+),
                                        Children (under 12). Proof may be required.</span>
                                </span>
                            </label>
                            <input type="number" id="quantity-discount" name="quantity_discount" value="0" min="0"
                                max="10" class="input-field quantity-input mb-0" oninput="updatePurchaseSummary()">
                        </div>
                        <div class="flex justify-between items-center">
                            <label for="quantity-free" class="mb-0 ticket-type-free-label">
                                Free Ticket:
                                <span class="tooltip-trigger" tabindex="0" onclick="toggleTooltip(this)"
                                    onmouseenter="showTooltip(this)" onmouseleave="hideTooltip(this)"
                                    onfocus="showTooltip(this)" onblur="hideTooltip(this)">?
                                    <span class="tooltip-text tooltip-free-text">Eligible: Infants (under 2), Specific
                                        promotions. Check details.</span>
                                </span>
                            </label>
                            <input type="number" id="quantity-free" name="quantity_free" value="0" min="0" max="10"
                                class="input-field quantity-input mb-0" oninput="updatePurchaseSummary()">
                        </div>
                    </div>
                </div>

                <div id="purchase-name-fields" class="mb-4 p-4 border rounded">
                    <h3 class="text-lg font-medium mb-3"><span class="attendee-info-title">Attendee Information</span>
                        (<span id="total-tickets-count">1</span> <span class="attendees-label">attendee(s)</span>)</h3>
                </div>

                <div class="mb-4 p-4 border rounded bg-gray-50">
                    <label for="purchase-email"><span class="email-label">Email:</span></label>
                    <input type="email" id="purchase-email" name="customer_email" required class="input-field">

                    <label for="purchase-usage-date"><span class="usage-date-label">Usage Date:</span></label>
                    <input type="date" id="purchase-usage-date" name="usage_date" required
                        onchange="validateUsageDate(this)" class="input-field">
                </div>

                <div class="text-right font-semibold my-4 text-xl">
                    <span class="total-price-label">Estimated Total:</span> <span id="purchase-total-price">Rp 0</span>
                </div>

                <button type="submit" id="proceed-to-payment-btn"
                    class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg shadow transition duration-300 text-lg">
                    <span class="proceed-payment-btn-text">Proceed to Payment (Simulation - Direct to Successful
                        Purchase)</span>
                </button>
            </form>
            <div id="purchase-error" class="text-center text-red-600 font-medium mt-4 hidden"></div>
        </div>

        <div id="message" class="text-center text-green-600 font-medium mb-4 min-h-[1.5em]"></div>
        <div id="error-message" class="text-center text-red-600 font-medium mb-4 min-h-[1.5em]"></div>

    </div>

    <div id="successModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <h2 id="modal-title" class="text-2xl font-semibold mb-4 text-green-600">Purchase Successful!</h2>
            <p id="modal-order-label" class="mb-2">Your Order ID is:</p>
            <p id="modalOrderId" class="text-xl font-bold mb-4"></p>
            <p id="modal-qr-label" class="mb-3">Please use the QR code below for entry:</p>
            <div id="qrcode"></div>
            <p id="modal-email-info" class="text-sm text-gray-500 mt-4">Details have been sent to your email
                (simulation).</p>
        </div>
    </div>

    <div id="floating-nav" class="hidden lg:flex">
    </div>


    <script>
        const API_BASE_URL = 'http://127.0.0.1:5000/api';
        // Array of background colors for attraction blocks
        const backgroundColors = [
            'bg-blue-100', 'bg-green-100', 'bg-yellow-100', 'bg-purple-100', 'bg-pink-100'
        ];
        let colorIndex = 0; // To cycle through colors

        // --- Translations ---
        const translations = {
            en: {
                title: "Solo City Attractions - Online Ticketing",
                mainTitle: "Solo City Attractions Online Ticketing",
                loadingText: "Loading attraction information...",
                noAttractions: "No attractions available for booking currently.",
                loadError: "Failed to load attractions:",
                detailLoadError: "Failed to load attraction details:",
                datePastError: "Date must be today or later.",
                basePriceLabel: "Base Price:",
                pricePending: "Free or Price TBD",
                noDesc: "No detailed description available.",
                noSummary: "No summary available.", // Added summary translation
                noDetails: "No detailed description available.", // Added details translation
                bookNowButton: "Book Now",
                backToList: "Back to List",
                backToDetail: "Back to Details",
                purchaseTitle: "Book Tickets for:",
                ticketSelectionTitle: "Ticket Selection",
                ticketTypeFullLabel: "Full Price Ticket:",
                ticketTypeDiscountLabel: "Discount Ticket (50%):",
                ticketTypeFreeLabel: "Free Ticket:",
                attendeeInfoTitle: "Attendee Information",
                attendeesLabel: "attendee(s)",
                nameLabel: "Name", // Numbered
                emailLabel: "Email:",
                usageDateLabel: "Usage Date:",
                totalPriceLabel: "Estimated Total:",
                proceedPaymentBtnText: "Proceed to Payment (Simulation - Direct to Successful Purchase)",
                purchaseButtonLoading: "Processing...",
                fillFieldsError: "Please fill in all required fields",
                fillNamesError: "Please enter names for all attendees",
                quantityError: "Total quantity must be between 1 and 10",
                purchaseSuccess: "Purchase successful! Order ID:",
                purchaseFail: "Purchase failed:",
                modalTitle: "Purchase Successful!",
                modalOrderLabel: "Your Order ID is:",
                modalQrLabel: "Please use the QR code below for entry:",
                modalEmailInfo: "Details have been sent to your email (simulation).",
                tooltipDiscount: "Eligible: Students, Seniors (60+), Children (under 12). Proof may be required.",
                tooltipFree: "Eligible: Infants (under 2), Specific promotions. Check details.",
                detailSectionDescription: "Detailed Description", // Added detail section titles
                detailSectionGallery: "Image Gallery",
                detailSectionInfo: "Related Information",
                contactLabel: "Contact:",
                addressLabel: "Address:",
                transportLabel: "Transportation:",
                noContact: "No contact information available.",
                noAddress: "No address information available.",
                noTransport: "No transportation information available.",
                imageGalleryError: "Failed to load some images.", // Added image gallery error
            },
            zh: {
                title: "梭罗市景点票务 - 在线购票",
                mainTitle: "梭罗市景点在线票务",
                loadingText: "正在加载景点信息...",
                noAttractions: "暂无可售票的景点。",
                loadError: "加载景点列表失败:",
                detailLoadError: "加载景点详情失败:",
                datePastError: "日期必须是今天或更晚。",
                basePriceLabel: "基础价格:",
                pricePending: "免费或价格待定",
                noDesc: "暂无详细描述。",
                noSummary: "暂无简介。", // Added summary translation
                noDetails: "暂无详细介绍。", // Added details translation
                bookNowButton: "立即预订",
                backToList: "返回列表",
                backToDetail: "返回详情",
                purchaseTitle: "预订门票:",
                ticketSelectionTitle: "选择票种和数量",
                ticketTypeFullLabel: "全价票:",
                ticketTypeDiscountLabel: "优惠票 (50%):",
                ticketTypeFreeLabel: "免费票:",
                attendeeInfoTitle: "游客信息",
                attendeesLabel: "位游客",
                nameLabel: "姓名", // Numbered
                emailLabel: "邮箱:",
                usageDateLabel: "使用日期:",
                totalPriceLabel: "预计总价:",
                proceedPaymentBtnText: "确认订单 (模拟支付)",
                purchaseButtonLoading: "处理中...",
                fillFieldsError: "请填写所有必填项",
                fillNamesError: "请输入所有游客的姓名",
                quantityError: "总票数必须在 1 到 10 之间",
                purchaseSuccess: "购买成功！订单号:",
                purchaseFail: "购买失败:",
                modalTitle: "购买成功!",
                modalOrderLabel: "您的订单号是:",
                modalQrLabel: "请使用下方二维码入场:",
                modalEmailInfo: "详细信息已发送至您的邮箱 (模拟)。",
                tooltipDiscount: "适用人群：学生、老年人（60岁以上）、儿童（12岁以下）。可能需要证件。",
                tooltipFree: "适用人群：婴幼儿（2岁以下）、特定活动。请查看详情。",
                detailSectionDescription: "详细介绍", // Added detail section titles
                detailSectionGallery: "图片展览",
                detailSectionInfo: "相关信息",
                contactLabel: "联系方式:",
                addressLabel: "地址:",
                transportLabel: "交通:",
                noContact: "暂无联系方式。",
                noAddress: "暂无地址信息。",
                noTransport: "暂无交通信息。",
                imageGalleryError: "部分图片加载失败。", // Added image gallery error
            }
        };
        let currentLang = 'en';
        let currentAttractionId = null; // Store ID of attraction being booked
        let currentAttractionBasePrice = 0; // Store base price for calculation

        // --- DOM Elements ---
        const views = document.querySelectorAll('.view');
        const attractionListView = document.getElementById('attraction-list-view');
        const attractionDetailView = document.getElementById('attraction-detail-view');
        const purchaseView = document.getElementById('purchase-view');
        // Changed from attractionsGrid to attractionsListContainer
        const attractionsListContainer = document.getElementById('attractions-list-container');
        const attractionsLoadingDiv = document.getElementById('attractions-loading');
        const attractionsErrorDiv = document.getElementById('attractions-error');
        const detailContent = document.getElementById('detail-content');
        const detailError = document.getElementById('detail-error');
        const purchaseForm = document.getElementById('purchase-form');
        const purchaseAttractionName = document.getElementById('purchase-attraction-name');
        const purchaseNameFieldsContainer = document.getElementById('purchase-name-fields');
        const purchaseTotalPrice = document.getElementById('purchase-total-price');
        const totalTicketsCountSpan = document.getElementById('total-tickets-count');
        const purchaseErrorDiv = document.getElementById('purchase-error');
        const proceedBtn = document.getElementById('proceed-to-payment-btn');
        const messageDiv = document.getElementById('message'); // Shared message divs
        const errorMessageDiv = document.getElementById('error-message');
        const successModal = document.getElementById('successModal');
        const modalOrderId = document.getElementById('modalOrderId');
        const qrCodeContainer = document.getElementById('qrcode');
        const pageTitle = document.querySelector('title');
        const mainTitle = document.getElementById('main-title');
        const loadingText = document.getElementById('loading-text');
        const modalTitle = document.getElementById('modal-title');
        const modalOrderLabel = document.getElementById('modal-order-label');
        const modalQrLabel = document.getElementById('modal-qr-label');
        const modalEmailInfo = document.getElementById('modal-email-info');
        // Removed individual language buttons
        // const langEnBtn = document.getElementById('lang-en');
        // const langZhBtn = document.getElementById('lang-zh');
        const floatingNav = document.getElementById('floating-nav'); // Floating nav bar
        const langSwitcher = document.getElementById('lang-switcher'); // Language switcher container
        const languageSelect = document.getElementById('language-select'); // Language select dropdown


        // --- Helper Functions ---
        function validateUsageDate(input) {
            const selectedDate = input.value;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const selected = new Date(selectedDate);
            selected.setHours(0, 0, 0, 0);

            if (selected < today) {
                showError(translations[currentLang].datePastError); // Show general error
                input.value = ''; // Clear the invalid date
                return false;
            }
            clearMessages(errorMessageDiv); // Clear general error if date is valid
            return true;
        }
        function showMessage(msg) { clearMessages(); messageDiv.textContent = msg; setTimeout(clearMessages, 5000); }
        function showError(msg, target = errorMessageDiv) { clearMessages(); target.textContent = msg; target.classList.remove('hidden'); setTimeout(() => clearMessages(target), 7000); }
        function clearMessages(target = null) {
            if (target) { target.textContent = ''; target.classList.add('hidden'); }
            else {
                messageDiv.textContent = ''; errorMessageDiv.textContent = ''; errorMessageDiv.classList.add('hidden');
                attractionsErrorDiv.textContent = ''; attractionsErrorDiv.classList.add('hidden');
                detailError.textContent = ''; detailError.classList.add('hidden');
                purchaseErrorDiv.classList.add('hidden');
            }
        }
        function setLoadingState(button, isLoading, loadingTextKey = 'purchaseButtonLoading') {
            if (button) {
                button.disabled = isLoading;
                if (isLoading) { button.dataset.originalText = button.textContent; button.textContent = translations[currentLang][loadingTextKey]; }
                else if (button.dataset.originalText) { button.textContent = button.dataset.originalText; }
            }
        }
        function openModal(orderId, qrData) {
            modalOrderId.textContent = orderId;
            qrCodeContainer.innerHTML = '';

            // Defensive check for QRCode availability
            if (typeof QRCode === 'undefined' || typeof QRCode.CorrectLevel === 'undefined') {
                console.error("QRCode or QRCode.CorrectLevel is not available when trying to open modal.");
                showError("Failed to generate QR code. Please try again.", purchaseErrorDiv); // Show a user-friendly error
                return; // Stop execution
            }

            new QRCode(qrCodeContainer, {
                text: qrData,
                width: 200,
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
            successModal.style.display = "block";
        }
        function closeModal() { successModal.style.display = "none"; qrCodeContainer.innerHTML = ''; }
        window.onclick = function (event) { if (event.target == successModal) { closeModal(); } }
        function toggleTooltip(element) { element.classList.toggle('active'); }
        function showTooltip(element) { /* CSS handles this */ }
        function hideTooltip(element) { element.classList.remove('active'); }

        // Function to check for local image and fallback
        function checkLocalImage(imgElement, localPath, fallbackUrl, placeholderUrl = 'https://placehold.co/600x400/cccccc/666666?text=Image+Not+Available') {
            // Temporarily set the src to the local path
            imgElement.src = localPath;

            // If the local image loads successfully, the onerror will not fire.
            // If the local image fails to load, onerror will fire.
            imgElement.onerror = () => {
                // If fallbackUrl is provided and is different from the placeholder, try it
                if (fallbackUrl && fallbackUrl !== placeholderUrl && fallbackUrl !== localPath) {
                    imgElement.onerror = () => {
                        // If fallback also fails, use the final placeholder
                        imgElement.src = placeholderUrl;
                    };
                    imgElement.src = fallbackUrl;
                } else {
                    // Otherwise, just use the placeholder
                    imgElement.src = placeholderUrl;
                }
            };
        }


        // --- View Management ---
        function showView(viewId, data = null) {
            clearMessages(); // Clear messages when changing views
            views.forEach(view => {
                view.classList.toggle('active', view.id === viewId);
            });
            // Scroll to top when changing views
            window.scrollTo(0, 0);

            // Show/hide floating nav and language switcher based on view
            if (viewId === 'attraction-list-view') {
                floatingNav.style.display = 'flex'; // Use flex to maintain column layout
                langSwitcher.style.display = 'block'; // Show language switcher
            } else if (viewId === 'attraction-detail-view') {
                floatingNav.style.display = 'none'; // Hide floating nav
                langSwitcher.style.display = 'block'; // Show language switcher
            }
            else if (viewId === 'purchase-view') {
                floatingNav.style.display = 'none'; // Hide floating nav
                langSwitcher.style.display = 'none'; // Hide language switcher on purchase page
            }


            // Load data if needed for the view
            if (viewId === 'attraction-detail-view' && data) {
                loadAttractionDetail(data); // data is attractionId
            } else if (viewId === 'purchase-view' && data) {
                setupPurchaseForm(data); // data is attraction object
            } else if (viewId === 'attraction-list-view') {
                // Optionally reload list if needed, or just show
                if (attractionsListContainer.children.length === 0 && !attractionsLoadingDiv.classList.contains('active')) {
                    loadAttractionList(); // Reload if empty and not already loading
                }
            }
        }

        // --- Language Function ---
        function setLanguage(lang) {
            console.log(`Attempting to set language to: ${lang}`); // Log language change attempt
            currentLang = lang;
            localStorage.setItem('preferredLang', lang);
            document.documentElement.lang = lang;

            // Set the selected value in the dropdown
            languageSelect.value = lang;

            // Update static text
            pageTitle.textContent = translations[lang].title;
            mainTitle.textContent = translations[lang].mainTitle;
            loadingText.textContent = translations[lang].loadingText;
            modalTitle.textContent = translations[lang].modalTitle;
            modalOrderLabel.textContent = translations[lang].modalOrderLabel;
            modalQrLabel.textContent = translations[lang].modalQrLabel;
            modalEmailInfo.textContent = translations[lang].modalEmailInfo;
            // Update back buttons
            document.querySelectorAll('.back-to-list-text').forEach(el => el.textContent = translations[lang].backToList);
            document.querySelectorAll('.back-to-detail-text').forEach(el => el.textContent = translations[lang].backToDetail);

            // Update texts in purchase view (even if switcher is hidden, in case user navigates back)
            document.querySelector('.ticket-selection-title').textContent = translations[lang].ticketSelectionTitle;
            document.querySelector('.attendee-info-title').textContent = translations[lang].attendeeInfoTitle;
            document.querySelector('.attendees-label').textContent = translations[lang].attendeesLabel;
            document.querySelector('.email-label').textContent = translations[lang].emailLabel;
            document.querySelector('.usage-date-label').textContent = translations[lang].usageDateLabel;
            document.querySelector('.total-price-label').textContent = translations[lang].totalPriceLabel;
            document.querySelector('.proceed-payment-btn-text').textContent = translations[lang].proceedPaymentBtnText;

            // Update tooltip text dynamically (important!)
            document.querySelector('.tooltip-discount-text').innerHTML = `<b>${translations[lang].ticketTypeDiscountLabel.replace(':', '')}</b> ${translations[lang].tooltipDiscount}`;
            document.querySelector('.tooltip-free-text').innerHTML = `<b>${translations[lang].ticketTypeFreeLabel.replace(':', '')}</b> ${translations[lang].tooltipFree}`;

            // Update detail section titles if detail view is active
            if (attractionDetailView.classList.contains('active')) {
                const detailDescTitle = detailContent.querySelector('.detail-desc-title');
                if (detailDescTitle) detailDescTitle.textContent = translations[lang].detailSectionDescription;
                const detailGalleryTitle = detailContent.querySelector('.detail-gallery-title');
                if (detailGalleryTitle) detailGalleryTitle.textContent = translations[lang].detailSectionGallery;
                const detailInfoTitle = detailContent.querySelector('.detail-info-title');
                if (detailInfoTitle) detailInfoTitle.textContent = translations[lang].detailSectionInfo;
                // Update info labels
                const contactLabelEl = detailContent.querySelector('.contact-label');
                if (contactLabelEl) contactLabelEl.textContent = translations[lang].contactLabel;
                const addressLabelEl = detailContent.querySelector('.address-label');
                if (addressLabelEl) addressLabelEl.textContent = translations[lang].addressLabel;
                const transportLabelEl = detailContent.querySelector('.transport-label');
                if (transportLabelEl) transportLabelEl.textContent = translations[lang].transportLabel;
            }

            // No longer needed for dropdown
            // langEnBtn.classList.toggle('active', lang === 'en');
            // langZhBtn.classList.toggle('active', lang === 'zh');

            // --- Reload the current view to update dynamic content from API ---
            const activeView = document.querySelector('.view.active');
            if (activeView) {
                console.log(`Active view is: ${activeView.id}`); // Log active view
                if (activeView.id === 'attraction-list-view') {
                    loadAttractionList(); // Reload list to update names, summaries, etc.
                } else if (activeView.id === 'attraction-detail-view' && currentAttractionId) {
                    loadAttractionDetail(currentAttractionId); // Reload detail to update text
                }
                // Removed the purchase view specific reload as per user request to hide switcher
                // else if (activeView.id === 'purchase-view' && currentAttractionId) {
                //     console.log(`Language switched to ${lang} on purchase view for attraction ID: ${currentAttractionId}. Fetching updated data...`); // Log fetch attempt
                //     fetchAttractionData(currentAttractionId).then(attraction => {
                //         console.log("Fetched attraction data for purchase view:", attraction); // Log fetched data
                //         if (attraction) {
                //             setupPurchaseForm(attraction);
                //             console.log("setupPurchaseForm called with updated data."); // Log setup call
                //         } else {
                //             console.error("Failed to fetch updated attraction data for purchase view."); // Log fetch failure
                //         }
                //     });
                // }
            } else {
                console.log("No active view found."); // Log if no active view
            }
        }

        // --- Data Loading ---
        async function fetchAttractionData(attractionId) {
            console.log(`Fetching data for attraction ID: ${attractionId} with language: ${currentLang}`); // Log fetch data call
            try {
                const response = await fetch(`${API_BASE_URL}/attractions/${attractionId}?lang=${currentLang}`);
                if (!response.ok) { throw new Error(`HTTP ${response.status}`); }
                const data = await response.json();
                console.log("Attraction data fetched successfully:", data); // Log successful fetch
                return data;
            } catch (error) {
                console.error(`Error fetching attraction ${attractionId}:`, error); // Log fetch error
                return null; // Indicate failure
            }
        }

        async function loadAttractionList() {
            console.log(`Loading attraction list with language: ${currentLang}`); // Log list load call
            attractionsLoadingDiv.classList.remove('hidden');
            attractionsListContainer.classList.add('hidden'); // Hide the container
            attractionsErrorDiv.classList.add('hidden');
            loadingText.textContent = translations[currentLang].loadingText;

            try {
                const response = await fetch(`${API_BASE_URL}/attractions?lang=${currentLang}`);
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.message || `Failed to load attractions (HTTP ${response.status})`);
                }
                const attractions = await response.json();
                console.log("Attraction list fetched successfully:", attractions); // Log successful fetch

                attractionsListContainer.innerHTML = ''; // Clear previous list
                floatingNav.innerHTML = ''; // Clear previous nav buttons
                colorIndex = 0; // Reset color index

                if (attractions.length === 0) {
                    attractionsListContainer.innerHTML = `<p class="text-center text-gray-500 col-span-full">${translations[currentLang].noAttractions}</p>`;
                } else {
                    attractions.forEach(attraction => {
                        const attractionBlock = createAttractionListBlock(attraction);
                        attractionsListContainer.appendChild(attractionBlock);

                        // Add button to floating nav
                        const navButton = document.createElement('button');
                        navButton.textContent = attraction.name;
                        navButton.onclick = () => {
                            // Scroll to the attraction block
                            document.getElementById(`attraction-${attraction.attraction_id}`).scrollIntoView({
                                behavior: 'smooth'
                            });
                        };
                        floatingNav.appendChild(navButton);
                    });
                }
                attractionsListContainer.classList.remove('hidden'); // Show the container

            } catch (error) {
                console.error('Failed to load attractions:', error);
                const errorPrefix = translations[currentLang].loadError;
                showError(`${errorPrefix} ${error.message}`, attractionsErrorDiv);
            } finally {
                attractionsLoadingDiv.classList.add('hidden');
            }
        }

        function createAttractionListBlock(attraction) {
            // Assign a background color and increment index
            const bgColorClass = backgroundColors[colorIndex % backgroundColors.length];
            colorIndex++;

            const block = document.createElement('div');
            // Add ID for scrolling
            block.id = `attraction-${attraction.attraction_id}`;
            block.className = `attraction-block ${bgColorClass}`;

            // Local image path simulation for homepage
            const localImagePath = `res/homepage/${attraction.attraction_id}.jpg`;
            const fallbackImageUrl = attraction.image_url || 'https://placehold.co/600x400/cccccc/666666?text=Image+Not+Available';


            const priceFormatted = attraction.price > 0 ? `Rp ${attraction.price.toLocaleString('id-ID')}` : translations[currentLang].pricePending;

            block.innerHTML = `
                <div class="attraction-image-container">
                    <img src="" alt="${attraction.name}" class="attraction-image">
                </div>
                <div class="attraction-info">
                    <h3>${attraction.name}</h3>
                    <p class="summary">${attraction.summary || translations[currentLang].noSummary}</p>
                    <p class="price">${priceFormatted}</p>
                    <button onclick="showView('attraction-detail-view', '${attraction.attraction_id}')" class="book-button">
                       <span class="book-now-button">${translations[currentLang].bookNowButton}</span>
                    </button>
                </div>
            `;

            // Use the checkLocalImage function for the main image
            const imgElement = block.querySelector('.attraction-image');
            checkLocalImage(imgElement, localImagePath, fallbackImageUrl);

            return block;
        }


        async function loadAttractionDetail(attractionId) {
            console.log(`Loading attraction detail for ID: ${attractionId} with language: ${currentLang}`); // Log detail load call
            currentAttractionId = attractionId; // Store current ID
            detailContent.innerHTML = `<div class="spinner"></div><p>${translations[currentLang].loadingText}</p>`; // Show loading
            detailError.classList.add('hidden');

            const attraction = await fetchAttractionData(attractionId);

            if (attraction) {
                // Local image path simulation for detail gallery
                const detailGalleryImagesHTML = await loadDetailGalleryImages(attraction.attraction_id);

                const priceFormatted = attraction.price > 0 ? `Rp ${attraction.price.toLocaleString('id-ID')}` : translations[currentLang].pricePending;
                currentAttractionBasePrice = attraction.price; // Store base price

                // Reordered sections: Gallery first, then Description, then Info
                detailContent.innerHTML = `
                    <h2 class="text-3xl font-bold mb-6 text-gray-800">${attraction.name}</h2>

                    <div class="detail-section">
                        <h3 class="detail-gallery-title">${translations[currentLang].detailSectionGallery}</h3>
                        <div class="image-gallery">
                            ${detailGalleryImagesHTML}
                        </div>
                    </div>

                    <div class="detail-section">
                        <h3 class="detail-desc-title">${translations[currentLang].detailSectionDescription}</h3>
                        <p>${attraction.details || translations[currentLang].noDetails}</p>
                    </div>

                    <div class="detail-section contact-info">
                        <h3 class="detail-info-title">${translations[currentLang].detailSectionInfo}</h3>
                        <p><strong class="contact-label">${translations[currentLang].contactLabel}</strong> ${attraction.contact_info || translations[currentLang].noContact}</p>
                        <p><strong class="address-label">${translations[currentLang].addressLabel}</strong> ${attraction.address_info || translations[currentLang].addressInfo}</p>
                        <p><strong class="transport-label">${translations[currentLang].transportLabel}</strong> ${attraction.transport_info || translations[currentLang].noTransport}</p>
                    </div>


                    <p class="text-xl font-bold text-blue-600 mb-6 text-right"><span class="base-price-label">${translations[currentLang].basePriceLabel}</span> ${priceFormatted}</p>

                    <button onclick="showView('purchase-view', ${JSON.stringify(attraction).replace(/"/g, '&quot;')})" class="w-full sm:w-auto bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-lg shadow text-lg transition duration-300">
                       <span class="book-now-button">${translations[currentLang].bookNowButton}</span>
                    </button>
                `;
            } else {
                const errorPrefix = translations[currentLang].detailLoadError;
                showError(`${errorPrefix} Attraction ID: ${attractionId}`, detailError);
                detailContent.innerHTML = ''; // Clear loading indicator
            }
        }

        // Simulate loading multiple detail images
        async function loadDetailGalleryImages(attractionId) {
            let imagesHTML = '';
            const placeholderUrl = 'https://placehold.co/150x150/cccccc/666666?text=Image'; // Placeholder for gallery
            const maxImagesToTry = 5; // Attempt to load up to 5 images

            for (let i = 1; i <= maxImagesToTry; i++) {
                const localImagePath = `res/details/${attractionId}_${i}.jpg`;
                // Create a temporary image element to check if the image loads
                const img = new Image();
                let loaded = false;

                // Use a Promise to wait for load or error
                await new Promise((resolve) => {
                    img.onload = () => {
                        loaded = true;
                        resolve();
                    };
                    img.onerror = () => {
                        loaded = false;
                        resolve();
                    };
                    img.src = localImagePath;
                });

                if (loaded) {
                    imagesHTML += `<img src="${localImagePath}" alt="${attractionId} Image ${i}">`;
                } else {
                    // Optionally add a placeholder if an image is missing in the sequence
                    // imagesHTML += `<img src="${placeholderUrl}" alt="Image not available">`;
                }
            }

            // If no images were found after trying, add a single placeholder
            if (imagesHTML === '') {
                imagesHTML = `<img src="${placeholderUrl}" alt="${translations[currentLang].imageGalleryError}">`;
            }

            return imagesHTML;
        }


        // --- Purchase Form Logic ---
        function setupPurchaseForm(attraction) {
            console.log("setupPurchaseForm called with attraction:", attraction); // Log setup call
            currentAttractionId = attraction.attraction_id; // Ensure this is set
            currentAttractionBasePrice = parseFloat(attraction.price || 0);
            purchaseAttractionName.textContent = attraction.name;

            // Reset form fields to defaults
            purchaseForm.reset(); // Resets native form elements
            updatePurchaseSummary(); // Updates quantities, names, total price based on defaults
        }

        function updatePurchaseSummary() {
            const quantities = {
                full: parseInt(document.getElementById('quantity-full').value) || 0,
                discount: parseInt(document.getElementById('quantity-discount').value) || 0,
                free: parseInt(document.getElementById('quantity-free').value) || 0,
            };

            let totalQuantity = 0;
            let totalPrice = 0;

            // Recalculate total quantity and price
            for (const type in quantities) {
                let q = quantities[type];
                if (isNaN(q) || q < 0) q = 0;
                if (q > 10) q = 10; // Enforce max per type
                quantities[type] = q; // Update the value if corrected
                document.getElementById(`quantity-${type}`).value = q; // Reflect correction in UI
                totalQuantity += q;

                let multiplier = 1.0;
                if (type === 'discount') multiplier = 0.5;
                else if (type === 'free') multiplier = 0.0;
                totalPrice += q * currentAttractionBasePrice * multiplier;
            }

            // Enforce overall max quantity (e.g., if user enters 6 full, 6 discount)
            if (totalQuantity > 10) {
                // This case is tricky. How to reduce? Simplest is to show error and disable purchase.
                showError(translations[currentLang].quantityError, purchaseErrorDiv);
                proceedBtn.disabled = true;
                totalQuantity = 10; // Cap for display purposes
            } else {
                purchaseErrorDiv.classList.add('hidden'); // Clear error if valid
                proceedBtn.disabled = false;
            }


            // Update total tickets count display
            totalTicketsCountSpan.textContent = totalQuantity;

            // Update dynamic name fields
            updatePurchaseNameFields(totalQuantity);

            // Update total price display
            purchaseTotalPrice.textContent = `Rp ${totalPrice.toLocaleString('id-ID')}`;
        }

        function updatePurchaseNameFields(totalQuantity) {
            purchaseNameFieldsContainer.innerHTML = ''; // Clear existing
            if (totalQuantity > 0 && totalQuantity <= 10) {
                const nameLabelBase = translations[currentLang].nameLabel;
                for (let i = 1; i <= totalQuantity; i++) {
                    const label = document.createElement('label');
                    label.htmlFor = `purchase_name_${i}`;
                    label.textContent = `${nameLabelBase} ${i}:`;

                    const input = document.createElement('input');
                    input.type = 'text';
                    input.id = `purchase_name_${i}`;
                    input.name = `customer_name_${i}`;
                    input.className = 'input-field';
                    input.required = true;

                    purchaseNameFieldsContainer.appendChild(label);
                    purchaseNameFieldsContainer.appendChild(input);
                }
            } else if (totalQuantity > 10) {
                // Handled by disabling button and showing error in updatePurchaseSummary
                purchaseNameFieldsContainer.innerHTML = `<p class="text-red-600">${translations[currentLang].quantityError}</p>`;
            }
        }

        function handleProceedToPayment(event) {
            event.preventDefault();
            clearMessages(); // Clear previous errors

            const quantities = {
                full: parseInt(document.getElementById('quantity-full').value) || 0,
                discount: parseInt(document.getElementById('quantity-discount').value) || 0,
                free: parseInt(document.getElementById('quantity-free').value) || 0,
            };
            const totalQuantity = quantities.full + quantities.discount + quantities.free;
            const customerEmail = document.getElementById('purchase-email').value;
            const usageDate = document.getElementById('purchase-usage-date').value;

            const customerNames = [];
            let allNamesFilled = true;
            for (let i = 1; i <= totalQuantity; i++) {
                const nameInput = document.getElementById(`purchase_name_${i}`);
                if (nameInput && nameInput.value.trim()) {
                    customerNames.push(nameInput.value.trim());
                } else {
                    allNamesFilled = false;
                    if (nameInput) nameInput.focus();
                    break;
                }
            }

            // Validation
            if (totalQuantity <= 0 || totalQuantity > 10) {
                showError(translations[currentLang].quantityError, purchaseErrorDiv); return;
            }
            if (!allNamesFilled) {
                showError(translations[currentLang].fillNamesError, purchaseErrorDiv); return;
                return; // Stop execution
            }
            if (!customerEmail || !usageDate) {
                showError(translations[currentLang].fillFieldsError, purchaseErrorDiv); return;
                return; // Stop execution
            }
            if (new Date(usageDate) < new Date()) {
                showError(translations[currentLang].datePastError, purchaseErrorDiv); return;
                return; // Stop execution
            }


            // --- Payment Simulation ---
            setLoadingState(proceedBtn, true);
            console.log("Simulating payment...");
            // In a real app, redirect to payment gateway or show payment form here.
            // We'll just simulate success after a delay.
            setTimeout(() => {
                console.log("Payment simulation successful.");
                // Now call the actual backend purchase API
                submitPurchase({
                    attraction_id: currentAttractionId,
                    quantities: quantities,
                    customer_names: customerNames,
                    customer_email: customerEmail,
                    usage_date: usageDate
                });
                // Keep button loading until API call finishes
            }, 1500); // Simulate 1.5 second payment process
        }

        async function submitPurchase(purchaseData) {
            // setLoadingState(proceedBtn, true); // Already loading from simulation

            try {
                const response = await fetch(`${API_BASE_URL}/purchase`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(purchaseData),
                });
                const result = await response.json();
                if (!response.ok) { throw new Error(result.message || `HTTP error! status: ${response.status}`); }

                openModal(result.order_id, result.qr_data);
                // Reset form and go back to list view after success
                purchaseForm.reset();
                updatePurchaseSummary(); // Reset summary display
                showView('attraction-list-view'); // Go back to list

            } catch (error) {
                console.error('Purchase submission failed:', error);
                const failPrefix = translations[currentLang].purchaseFail;
                showError(`${failPrefix} ${error.message}`, purchaseErrorDiv); // Show error in purchase view
            } finally {
                setLoadingState(proceedBtn, false); // Re-enable button after API call
            }
        }


        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            const preferredLang = localStorage.getItem('preferredLang') || 'en';
            // Set the initial value of the select dropdown
            languageSelect.value = preferredLang;
            setLanguage(preferredLang); // Call setLanguage with the initial preferred language

            // Add event listener for the dropdown change
            languageSelect.addEventListener('change', (event) => {
                setLanguage(event.target.value);
            });

            // Add a check for QRCode.CorrectLevel on DOMContentLoaded
            if (typeof QRCode !== 'undefined' && QRCode.CorrectLevel) {
                console.log("QRCode.CorrectLevel is available on DOMContentLoaded.");
            } else {
                console.error("QRCode or QRCode.CorrectLevel is NOT available on DOMContentLoaded.");
            }
        });
    </script>

</body>

</html>